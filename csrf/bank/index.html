<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=, initial-scale=1.0"
  >
  <title>ç®€æ˜“çš„é“¶è¡Œç³»ç»Ÿ</title>
</head>
<style>
  .hidden {
    display: none;
  }
</style>

<body>
  <!-- ç™»å½•ç•Œé¢ -->
  <div id="userLogin">
    <h2>ç”¨æˆ·ç™»å½•</h2>
    <div class="login-form">
      <input
        type="text"
        placeholder="ç”¨æˆ·å"
        value="chp"
        id="userName"
      >
      <input
        type="password"
        id="userPsd"
      >
    </div>
    <button onclick="handleLogin()">ç™»å½•</button>
  </div>
  <!-- ç™»å½•æˆåŠŸåçš„é¡µé¢ -->
  <div
    id="userContent"
    class="hidden"
  >
    <h2>ç”¨æˆ·ç™»å½•æˆåŠŸ</h2>
    <p>æ¬¢è¿å›æ¥ï¼ŒdemochUserï¼</p>
    <p>æ‚¨çš„è´¦æˆ·å®‰å…¨çº§åˆ«ä¸ºï¼šã€å‡ ä¹æ²¡æœ‰ã€‘</p>
  </div>
  <button onclick="handleLogout()">ç™»å‡º</button>
  <input
    id="money"
    type="number"
    value="1000"
    placeholder="è¯·è¾“å…¥æ‚¨è¦è½¬è´¦çš„é‡‘é¢"
  />
  <button onclick="transfer()">è½¬è´¦</button>
</body>
<script>
  const handleLogin = () => {
    const name = document.getElementById('userName').value;
    const psd = document.getElementById('userPsd').value;
    if (!name || !psd) {
      alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ')
      return false;
    }
    fetch('/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json', // âœ… å¿…é¡»è®¾ç½®
      },
      body: JSON.stringify({
        name,
        psd
      })
    }).then(res => res.json()).then(res => {
      if (res.code === 200) {
        document.getElementById('userLogin').classList.add('hidden');
        document.getElementById('userContent').classList.remove('hidden');
        return;
      }
      alert(res.msg);
    })
  }
  const handleLogout = () => {
    fetch('/logout', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json', // âœ… å¿…é¡»è®¾ç½®
      },
      credentials: 'include'
    }).then(res => res.json()).then(res => {
      if (res.code === 200) {
        document.getElementById('userLogin').classList.remove('hidden');
        document.getElementById('userContent').classList.add('hidden');
        alert('ç™»å‡ºæˆåŠŸ')
        return;
      }
      alert(res.msg);
    })
  }
  const transfer = () => {
    const money = document.getElementById('money').value;
    if (!money) {
      alert('è¯·è¾“å…¥é‡‘é¢');
      return false;
    }
    fetch('/transfer', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json', // âœ… å¿…é¡»è®¾ç½®
      },
      body: JSON.stringify({
        money
      })
    }).then(res => res.json()).then(res => {
      console.log('ğŸ€ğŸ€ğŸ€ğŸ€', res)
      if (res.code === 200) {
        alert('è½¬è´¦æˆåŠŸ');
        return;
      } else {
        alert(res.msg)
      }
    })
  }
</script>

</html>
